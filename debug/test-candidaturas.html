<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Sistema de Candidaturas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Teste do Sistema de Candidaturas</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Teste 1: Verificar Conexão -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-database text-blue-500 mr-2"></i>
                    Conexão com Banco
                </h2>
                <button onclick="testarConexao()" class="btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Testar Conexão
                </button>
                <div id="conexao-result" class="mt-4"></div>
            </div>

            <!-- Teste 2: Listar Candidaturas -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-list text-green-500 mr-2"></i>
                    Listar Candidaturas
                </h2>
                <button onclick="listarCandidaturas()" class="btn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Listar Todas
                </button>
                <div id="lista-result" class="mt-4"></div>
            </div>

            <!-- Teste 3: Adicionar Candidatura Teste -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-plus text-yellow-500 mr-2"></i>
                    Adicionar Teste
                </h2>
                <button onclick="adicionarTeste()" class="btn bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    Adicionar Candidatura
                </button>
                <div id="adicionar-result" class="mt-4"></div>
            </div>
        </div>

        <!-- Área de Resultados -->
        <div class="mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Resultados dos Testes</h2>
            <div id="output" class="bg-white rounded-lg shadow-md p-6 min-h-[200px]">
                <p class="text-gray-500">Execute os testes acima para ver os resultados aqui.</p>
            </div>
        </div>
    </div>

    <script>
        function updateOutput(content) {
            document.getElementById('output').innerHTML = content;
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<i class="fas fa-spinner fa-spin"></i> Carregando...';
        }

        function showSuccess(elementId, message) {
            document.getElementById(elementId).innerHTML = `<span class="text-green-600"><i class="fas fa-check"></i> ${message}</span>`;
        }

        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `<span class="text-red-600"><i class="fas fa-times"></i> ${message}</span>`;
        }

        function testarConexao() {
            showLoading('conexao-result');
            
            fetch('../config/database.php')
                .then(response => {
                    if (response.ok) {
                        showSuccess('conexao-result', 'Arquivo de configuração encontrado');
                        updateOutput(`
                            <h3 class="text-lg font-semibold text-green-600 mb-2">✓ Teste de Conexão</h3>
                            <p>Arquivo de configuração do banco de dados foi encontrado.</p>
                            <p class="text-sm text-gray-600 mt-2">Próximo: Teste a API de candidaturas.</p>
                        `);
                    } else {
                        showError('conexao-result', 'Arquivo não encontrado');
                    }
                })
                .catch(error => {
                    showError('conexao-result', 'Erro na requisição');
                    updateOutput(`
                        <h3 class="text-lg font-semibold text-red-600 mb-2">✗ Erro de Conexão</h3>
                        <p>Erro: ${error.message}</p>
                    `);
                });
        }

        function listarCandidaturas() {
            showLoading('lista-result');
            
            fetch('../api/ajax_candidaturas.php?action=get_candidaturas')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showSuccess('lista-result', `${data.candidaturas.length} candidaturas encontradas`);
                        
                        let html = `
                            <h3 class="text-lg font-semibold text-green-600 mb-4">✓ Candidaturas Carregadas</h3>
                            <div class="space-y-2">
                        `;
                        
                        if (data.candidaturas.length > 0) {
                            data.candidaturas.forEach(candidatura => {
                                const statusClass = candidatura.status === 'aprovado' ? 'text-green-600' : 
                                                  candidatura.status === 'rejeitado' ? 'text-red-600' : 'text-yellow-600';
                                html += `
                                    <div class="bg-gray-50 p-3 rounded border-l-4 border-blue-500">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <strong>${candidatura.nome}</strong>
                                                <span class="${statusClass} ml-2">(${candidatura.status})</span>
                                                <br>
                                                <small class="text-gray-600">
                                                    ${candidatura.curso} - ${candidatura.serie}ª série | 
                                                    Evento: ${candidatura.evento_nome || 'N/A'}
                                                </small>
                                            </div>
                                            <small class="text-gray-500">${new Date(candidatura.data_candidatura).toLocaleDateString('pt-BR')}</small>
                                        </div>
                                    </div>
                                `;
                            });
                        } else {
                            html += '<p class="text-gray-500">Nenhuma candidatura encontrada.</p>';
                        }
                        
                        html += '</div>';
                        updateOutput(html);
                    } else {
                        showError('lista-result', data.message);
                        updateOutput(`
                            <h3 class="text-lg font-semibold text-red-600 mb-2">✗ Erro ao Listar</h3>
                            <p>Erro: ${data.message}</p>
                        `);
                    }
                })
                .catch(error => {
                    showError('lista-result', 'Erro na API');
                    updateOutput(`
                        <h3 class="text-lg font-semibold text-red-600 mb-2">✗ Erro na API</h3>
                        <p>Erro: ${error.message}</p>
                        <p class="text-sm text-gray-600 mt-2">Verifique se o arquivo ajax_candidaturas.php existe e está funcionando.</p>
                    `);
                });
        }

        function adicionarTeste() {
            showLoading('adicionar-result');
            
            fetch('../api/ajax_candidaturas.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'action=add_candidatura_teste'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess('adicionar-result', 'Candidatura adicionada');
                    updateOutput(`
                        <h3 class="text-lg font-semibold text-green-600 mb-2">✓ Candidatura de Teste Adicionada</h3>
                        <p>Uma nova candidatura de teste foi criada com sucesso.</p>
                        <p class="text-sm text-gray-600 mt-2">Agora você pode listar as candidaturas para ver o resultado.</p>
                    `);
                } else {
                    showError('adicionar-result', data.message);
                    updateOutput(`
                        <h3 class="text-lg font-semibold text-red-600 mb-2">✗ Erro ao Adicionar</h3>
                        <p>Erro: ${data.message}</p>
                    `);
                }
            })
            .catch(error => {
                showError('adicionar-result', 'Erro na API');
                updateOutput(`
                    <h3 class="text-lg font-semibold text-red-600 mb-2">✗ Erro na API</h3>
                    <p>Erro: ${error.message}</p>
                `);
            });
        }
    </script>
</body>
</html>
